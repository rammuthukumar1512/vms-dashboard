<div *ngIf="hasVulnerability" class="container-fluid">
  <!-----------------row1-start------------------------------------------------> 
  <div class="container-fluid p-2"> 
  <div class="row justify-content-between align-items-center ps-2">
    <div class="row align-items-center w-fit-content">
    <div class="w-fit-content h5 text-nowrap d-flex align-items-center"><span class="cursor-pointer" (click)="goBack()"><img src="images/arrow_back_32dp_000000_FILL0_wght400_GRAD0_opsz40.png" alt="back_arrow"></span>&nbsp;  CVE Id: <span class="text-primary">{{cveId}}</span></div>
    <div *ngIf="cvssMetrics.length > 1" class="d-flex flex-wrap w-fit-content ps-3 pt-2"> <button mat-raised-button class="custom-flat-button ms-2" (click)="setMetricData(metric, i)" [class.active]="i === btnActiveIndex" *ngFor="let metric of cvssMetrics; let i = index">Version {{metric.version}}</button> </div>
    </div>
  </div>
  </div>
    <div class="row px-3 justify-content-between">
<!----------------------------chart-section-start------------------------------>
        <div class="custom-db-col rounded-2 bg-light border mt-2">
        <div class="p-2 bg-gray-shade rounded-top-2">
            <span class="custom-fw-1">Base Score <span class="text-primary fw-bold">{{baseScore}}</span></span>
            <!-- <span class="float-end"><mat-icon class="material-symbols-outlined">settings</mat-icon></span> -->
            <div></div>
        </div>
      <canvas #severityChart role="img" class="pt-1" aria-label="CVSS Scores Bar Chart"></canvas>
        </div>
     <!----------------------------chart-section-end-------------------------------->

     <!---------------------------Score-Metrics-start------------------------------->
        <div #baseScoreParent class="custom-db-col bg-light rounded-2 border mt-2">
            <div class="p-2 rounded-top-2 bg-gray-shade">
            <span class="custom-fw-1">Base Score Metrics</span>
            <!-- <span class="float-end"><mat-icon class="material-symbols-outlined">settings</mat-icon></span> -->
            </div>
            <div class="container-fluid">
            <div #baseScoreChild class="row app-overflow app-vul-scrollbar">
               <div class="col-lg-6 p-3">
                <table class="w-100 app-explo-table">
                    <thead>
                        <tr>
                            <th colspan="2">Exploitability Metrics</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="text-nowrap">Attack Vector (AV)</td><td class="text-secondary word-break">{{attackVector || "N/A"}}</td></tr>
                        <tr><td class="text-nowrap">Attack Complexity (AC)</td><td class="text-secondary">{{attackComplexity || "N/A"}}</td></tr>
                        <tr><td class="text-nowrap">Privileges Required (PR)</td><td class="text-secondary">{{privilegesRequired || "N/A"}}</td></tr>
                        <tr><td class="text-nowrap">User Interaction (UI)</td><td class="text-secondary">{{userInteraction || "N/A"}}</td></tr>
                        <tr><td class="text-nowrap">Scope (S)</td><td class="text-secondary">{{scope || "N/A"}}</td></tr>
                    </tbody>
                </table>
               </div> 
               <div class="col-lg-6 p-3">
                <table class="w-100 app-explo-table">
                    <thead>
                        <tr>
                            <th colspan="2">Impact Metrics</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="text-nowrap">Confidentiality Impact (C)</td><td class="text-secondary">{{confidentiality || "N/A"}}</td></tr>
                        <tr><td class="text-nowrap">Integrity Impact (I)</td><td class="text-secondary">{{integrity || "N/A"}}</td></tr>
                        <tr><td class="text-nowrap">Availability Impact (A)</td><td class="text-secondary">{{availability || "N/A"}}</td></tr>
                    </tbody>
                </table>
               </div> 
               <div #baseScoreFooter class="pb-2 lh-1">
                <p class="text-center text-primary fw-bold">CVSS v{{version}} vector</p>
                <p class="fs-6 text-center"><span>Vector String:</span>  <span class="text-secondary">{{vectorString}}</span></p>
               </div>
            </div>
            </div>
        </div>
<!---------------------------Score-Metrics-end----------------------------------------------->
        </div>
<!---------------------------row1-end------------------------------------------------->

<!---------------------------row2-start------------------------------------------------->
        <div class="row px-3 pb-3 justify-content-between">
<!---------------------------affected-products-section-start---------------------------->            
        <div style="height: 400px;" #affectedProductsTemplate class="custom-db-col bg-light rounded-2 border mt-2">
            <div class="p-2 rounded-top-2 bg-gray-shade">
                <span class="custom-fw-1">Affected Products</span>
                <!-- <span class="float-end"><mat-icon class="material-symbols-outlined">settings</mat-icon></span> -->
            </div>
            <div #affectedProductsChild class="p-3 app-overflow app-vul-scrollbar">
            <div class="h5 py-2">Affected product list</div>    
            <ng-container *ngFor="let products of affectedProducts">   
            <table class="w-100 mt-1 table app-vuln-table table-responsive table-borderless table-striped">
                
                <tbody>  
                    <tr><th class="text-nowrap col-2">CPE Name</th><td class="text-primary col-10"><span class="cursor-pointer">{{products.cpeName || "N/A"}}</span></td></tr>
                    <tr *ngIf="products.versionStartIncluding || products.versionStartExcluding || 
                    products.versionEndIncluding || products.versionEndExcluding">
                    <th class="col-2">Version</th><td class="text-nowrap col-10"><span *ngIf="products.versionStartIncluding || products.versionStartExcluding">from</span> {{products.versionStartIncluding ? products.versionStartIncluding : products.versionStartExcluding ?
                      products.versionStartExcluding : "" }} <span *ngIf="products.versionStartIncluding">(Including)</span> <span *ngIf="products.versionStartExcluding">(Excluding)</span> <span *ngIf="products.versionEndIncluding || products.versionEndExcluding"> upto</span> {{products.versionEndIncluding ? products.versionEndIncluding : products.versionEndExcluding ?
                      products.versionEndExcluding : "" }} <span *ngIf="products.versionEndIncluding">(Including)</span> <span *ngIf="products.versionEndExcluding">(Excluding)</span></td></tr>
                </tbody>
            </table>
            </ng-container>
        </div>
        </div>
<!---------------------------affected-products-section-end---------------------------->  

<!---------------------------remediation-section-start-------------------------------->  
        <div style="height: 400px;" #remediationTemplate class="custom-db-col bg-light rounded-2 border mt-2">
            <div class="p-2 rounded-top-2 bg-gray-shade">
                <span class="custom-fw-1">Remediation Guidance</span>
                <!-- <span class="float-end"><mat-icon class="material-symbols-outlined">settings</mat-icon></span> -->
            </div>
            <div #remediationChild class="p-3 app-overflow app-vul-scrollbar">
                <table class="table table-responsive table-striped app-vuln-table">
                    <caption class="h5 caption-side-top">Links to Security Advisories, Fixes, and Utilities</caption>
                    <thead>
                        <tr>
                            <th>Hyper Links</th><th class="text-white">Resource</th>
                        </tr>
                    </thead>
                    <tbody *ngIf="references.length > 0; else noReferenceData">
                        <ng-container *ngFor="let reference of references">
                        <tr>
                            <td class="text-break"><a [href]="reference.referenceUrl" target="_blank">{{reference.referenceUrl}}</a></td>
                            <td>
                                <div class="d-flex flex-column pe-2" *ngFor="let resource of reference.referenceTags">
                                   <span class="badge bg-secondary mt-1">{{resource}}</span>
                                </div>   
                            </td>
                        </tr>
                        </ng-container>
                    </tbody>
                    <tbody>
                        <ng-template #noReferenceData>
                            <tr><td colspan="2" class="text-center text-secondary py-2">No Links Found</td></tr>
                        </ng-template>
                    </tbody>
                </table>
                </div>
        </div>
<!---------------------------remediation-section-end-------------------------------->        
    </div>
<!---------------------------row2-end------------------------------------------------->    
</div>

<!--------------------------------No-vulnerability-data-start------------------------------------->
<div #noVulnerability *ngIf="!hasVulnerability" class="no-vulnerability d-flex justify-content-center align-items-center mt-2">
  <div class="text-center">
    <span class="h3">No Vulnerability Data Found</span>
  </div>
</div>
<!--------------------------------No-vulnerability-data-end--------------------------------------->