
<!-- Application Dashboard section start -->
 <div class="col-md-12 p-3">
   <!-- First column container start -->
<div class="container-fluid"> 
  <div class="row border border-1 bg-light rounded-3">
   
    <div class="container-fluid">
      <!-- Top Metrics start -->
      <div class="row align-items-center pt-3">
        <div class="col-6 d-flex justify-content-center">
          <div class="w-75 rounded border border-1 py-2">
            <p class="text-center" style="opacity: 0.9;">Installed Applications</p>
            <p class="text-center h1">{{ appData.length }}</p>
          </div>
        </div>
        <div class="col-6 d-flex justify-content-center">
          <div class="w-75 rounded border border-1 py-2">
            <p class="text-center" style="opacity: 0.9;">Vulnerable Applications</p>
            <p class="text-center h1">{{ vulnerableSoftwareCount }}</p>
          </div>
        </div>
      </div>
      <!-- top metrics end -->
    </div>
   


    <!-- Charts Section start -->
    <div class="container-fluid mt-3">
      <div class="row">
        <div class="col-md-6">
          <p class="fw-bold text-center">Vulnerable Overview</p>
          <div class="chart">
            <canvas #appChart></canvas>
          </div>
        </div>
        <div class="col-md-6 p-0">
          <p class="fw-bold text-center">Severity</p>
          <div class="chart">
            <canvas #severityChart></canvas>
          </div>
        </div>
      </div>
    </div>
    <!-- chart section end -->
 </div>
</div>
 <!-- First column container end -->
   
 <div class="d-flex justify-content-between mt-3 gap-5">
 <span class="text-black-shade fs-5 fw-bold">Applications</span>
 <span class="text-black-shade fs-5 fw-bold machine-name"> Machine Name :<span class="machine"> {{ machineName }}</span></span>
</div>
 <!-- Table Section -->
    <div class="container-fluid mt-3 p-2 rounded-3 border border-1 bg-light">
<div class="d-flex justify-content-between align-items-center mt-3 flex-wrap gap-2">
  <!-- Severity Filter Buttons start-->
  <div class="d-flex gap-2 flex-wrap">
    <button class="btn btn-outline-secondary btn-sm custom-critical"
            [ngClass]="{'bg-opacity-75': severityFilter !== 'Critical' }"
            (click)="filterBySeverity('Critical')">
      Critical
    </button>
    <button class="btn btn-outline-secondary btn-sm custom-high"
            [ngClass]="{'bg-opacity-75': severityFilter !== 'High' }"
            (click)="filterBySeverity('High')">
      High
    </button>
    <button class="btn btn-outline-secondary btn-sm custom-medium"
            [ngClass]="{'bg-opacity-75': severityFilter !== 'Medium' }"
            (click)="filterBySeverity('Medium')">
      Medium
    </button>
    <button class="btn btn-outline-secondary btn-sm custom-low"
            [ngClass]="{'bg-opacity-75': severityFilter !== 'Low' }"  
            (click)="filterBySeverity('Low')">
      Low
    </button>
    <button class="btn btn-outline-secondary btn-sm"
            [class.active]="!severityFilter"
            (click)="filterBySeverity(null)">
      All
    </button>
  </div>
  <!-- Severity Filter Buttons end-->

  <!-- Search Bar -->
  <input class="comp-search-field rounded ps-3 py-1 border border-1"
         type="text"
         placeholder="Search"
         (keyup)="searchApplications($event)">
</div>


      <div class="overflow-auto mt-3" style="max-height: 300px;">
        <table mat-table [dataSource]="pagedAppData" class="comp-table w-100">

          <!-- Software Name -->
          <ng-container  matColumnDef="softwareName">
            <th  class="col-4 text-secondary fw-bolder" mat-header-cell *matHeaderCellDef>Software Name</th>
<td mat-cell *matCellDef="let app">
  {{ app.softwareName }}
  <i
    *ngIf="app.criticalVulnerabilityCount + app.highVulnerabilityCount + app.mediumVulnerabilityCount + app.lowVulnerabilityCount > 0"
    class="fa-solid fa-triangle-exclamation ms-2 text-danger"
  ></i>
</td>
          </ng-container>

          <!-- Software Version -->
          <ng-container matColumnDef="softwareVersion">
            <th  class="col-4 text-secondary fw-bolder" mat-header-cell *matHeaderCellDef>Version</th>
            <td mat-cell *matCellDef="let app">{{ app.softwareVersion }}</td>
          </ng-container>

          <!-- Vendor -->
          <ng-container matColumnDef="vendor">
            <th  class="col-4 text-secondary fw-bolder" mat-header-cell *matHeaderCellDef>Vendor</th>
            <td mat-cell *matCellDef="let app">{{ app.vendor }}</td>
          </ng-container>

          <!-- Vulnerability Count -->
          <ng-container matColumnDef="vulnerabilityCount">
            <th  class="col-4 text-secondary text-center fw-bolder" mat-header-cell *matHeaderCellDef>Vulnerabilities</th>
            <td class="text-center" mat-cell *matCellDef="let app">
              {{
                app.criticalVulnerabilityCount +
                app.highVulnerabilityCount +
                app.mediumVulnerabilityCount +
                app.lowVulnerabilityCount
              }}
            </td>
          </ng-container>

          <!-- Table Rows -->
           <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      (click)="showVulnerabilities(row)"
      class="cursor-pointer"
      [ngClass]="{
        'vulnerable-row': row.criticalVulnerabilityCount + row.highVulnerabilityCount +
                          row.mediumVulnerabilityCount + row.lowVulnerabilityCount > 0,
        'normal-row': row.criticalVulnerabilityCount + row.highVulnerabilityCount +
                      row.mediumVulnerabilityCount + row.lowVulnerabilityCount === 0
      }"
    ></tr>
        </table>

        <!-- No Data -->
        <div *ngIf="!pagedAppData.length" class="text-center p-2">No data found</div>
      </div>

      <!-- Pagination -->
      <div *ngIf="pagedAppData.length > 0" class="d-flex justify-content-end mt-2">
        <div class="col-7 d-flex justify-content-evenly align-items-center  height-fit-content">
           <mat-select
          class="border rounded page-size-width p-2"
          [(ngModel)]="recordIndex"
          (ngModelChange)="getPage($event)"
        >
          <mat-option *ngFor="let record of totalRecords" [value]="record">
            {{ record }}
          </mat-option>
        </mat-select>
          <mat-select class="border rounded page-size-width p-2"
                      [(ngModel)]="pageSize"
                      (ngModelChange)="onPageSizeChange($event)">
            <mat-option *ngFor="let size of pageSizes" [value]="size">{{ size }}</mat-option>
          </mat-select>

          <button (click)="previousPage()"
                  [disabled]="pageIndex === 0"
                  class="page-custom-btn btn d-flex justify-content-center align-items-center outline-0 border-0 p-2">
            <mat-icon class="material-symbols-outlined fs-5">arrow_back_ios</mat-icon>
          </button>

          <button (click)="nextPage()"
                  [disabled]="pageIndex >= totalPages - 1"
                  class="page-custom-btn btn d-flex justify-content-center align-items-center outline-0 border-0 p-2">
            <mat-icon class="material-symbols-outlined fs-5">arrow_forward_ios</mat-icon>
          </button>
        </div>
      </div> <!-- pagination end-->
    </div> <!-- Application table date end-->
    </div>
<!-- Application Dashboard section end -->