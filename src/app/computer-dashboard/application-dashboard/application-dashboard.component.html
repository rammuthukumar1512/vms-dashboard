
<!-- Application Dashboard section start -->
   <!-- First column container start -->
<div class="container-fluid"> 
  <div class="row border border-1 bg-light rounded-3">
      <div class="d-flex justify-content-between w-100 p-3 gap-3">
        <div class="w-50">
         <p class="text-black-shade fs-10 fw-bold"> Machine Name :<span style="word-break: break-all;" class="text-primary"> {{ machineName }}</span></p>
         </div>
         <div class="w-50">
          <p class="text-black-shade fs-10 fw-bold"> Logged In User :<span style="word-break: break-all;" class="text-primary"> {{ loggedInUser }}</span></p>
          </div>
      </div>
    <div class="container-fluid">
      <!-- Top Metrics start -->
      <div class="row align-items-center pt-0">
        <div class="col-6 d-flex justify-content-center">
          <div class="w-75 rounded border border-1 py-2">
            <p class="text-center" style="opacity: 0.9;">Installed Applications</p>
            <p class="text-center h1">{{ appData.length }}</p>
          </div>
        </div>
        <div class="col-6 d-flex justify-content-center">
          <div class="w-75 rounded border border-1 py-2">
            <p class="text-center" style="opacity: 0.9;">Vulnerable Applications</p>
            <p class="text-center h1">{{ vulnerableSoftwareCount }}</p>
          </div>
        </div>
      </div>
      <!-- top metrics end -->
    </div>
   


    <!-- Charts Section start -->
    <div class="container-fluid mt-3">
      <div class="row">
        <div class="col-md-6 p-0">
          <p class="fw-bold text-center text-black-shade">Applications Overview</p>
          <div class="chart">
            <canvas #appChart></canvas>
          </div>
        </div>
        <div class="col-md-6 p-0">
          <p class="fw-bold text-center text-black-shade">Severity</p>
          <div class="chart">
            <canvas class="p-2" #severityChart></canvas>
          </div>
        </div>
      </div>
    </div>
    <!-- chart section end -->
 </div>
</div>
 <!-- First column container end -->
   
 <div class="d-flex justify-content-around mt-3">
 <span class="text-black-shade fs-5 fw-bold">Applications</span>
 <span class="gap-0 text-black-shade">
  <i class="fa-solid fa-triangle-exclamation text-danger"></i>
  Vulnerable Application
</span>
<span class="gap-0 text-black-shade">
  <span class="material-symbols-outlined text-warning">shield_question</span>
  Unresolved Application
</span>

</div>
 <!-- Table Section -->
    <div class="container-fluid mt-3 p-2 rounded-3 border border-1 bg-light">
<div class="d-flex justify-content-between align-items-center mt-3 flex-wrap gap-2">

  <!-- Severity Filter Buttons start-->
<div class="d-flex gap-2 flex-wrap">
  <button class="btn btn-sm severity-btn custom-critical"
          [class.active-critical]="severityFilter === 'Critical'"
          (click)="filterBySeverity('Critical')">
    Critical
  </button>

  <button class="btn btn-sm severity-btn custom-high"
          [class.active-high]="severityFilter === 'High'"
          (click)="filterBySeverity('High')">
    High
  </button>

  <button class="btn btn-sm severity-btn custom-medium"
          [class.active-medium]="severityFilter === 'Medium'"
          (click)="filterBySeverity('Medium')">
    Medium
  </button>

  <button class="btn btn-sm severity-btn custom-low"
          [class.active-low]="severityFilter === 'Low'"
          (click)="filterBySeverity('Low')">
    Low
  </button>

  <button class="btn btn-sm severity-btn"
          [class.active-all]="!severityFilter"
          (click)="filterBySeverity(null)">
    All
  </button>
</div>
<!-- Severity Filter Buttons end-->

  <!-- Severity Filter Buttons end-->

  <!-- Search Bar -->
 <input class="comp-search-field rounded ps-3 py-1 border border-1"
         type="text"
         placeholder="Search"
         [(ngModel)]="searchValue"
         (keyup)="searchApplications($event)">
</div>


      <div class="overflow-auto mt-3" style="max-height: 300px;">
        <table mat-table [dataSource]="pagedAppData" class="comp-table w-100">

          <!-- Software Name -->
          <ng-container  matColumnDef="softwareName">
            <th  class="text-secondary fw-bolder" mat-header-cell *matHeaderCellDef>Software Name</th>

<td mat-cell *matCellDef="let app" class="gap-1">
  <span class="p-1">{{ app.softwareName }}</span>
  <span *ngIf="!app.resolved" class="material-symbols-outlined text-warning">shield_question</span>
  <span *ngIf="(app.criticalVulnerabilityCount + app.highVulnerabilityCount + app.mediumVulnerabilityCount + app.lowVulnerabilityCount) > 0"
        class="text-danger">
    ({{
      app.criticalVulnerabilityCount +
      app.highVulnerabilityCount +
      app.mediumVulnerabilityCount +
      app.lowVulnerabilityCount
    }})
  </span>
   <i
    *ngIf="app.criticalVulnerabilityCount + app.highVulnerabilityCount + app.mediumVulnerabilityCount + app.lowVulnerabilityCount > 0"
    class="fa-solid fa-triangle-exclamation text-danger"
  ></i>
</td>

          </ng-container>

          <!-- Software Version -->
          <ng-container matColumnDef="softwareVersion">
            <th  class="text-secondary fw-bolder text-center " mat-header-cell *matHeaderCellDef>Version</th>
            <td class="text-center" mat-cell *matCellDef="let app">{{ app.softwareVersion }}</td> 
          </ng-container>

          <!-- Vendor -->
          <ng-container matColumnDef="vendor">
            <th  class="text-secondary fw-bolder text-center " mat-header-cell *matHeaderCellDef>Vendor</th>
            <td class="text-center"mat-cell *matCellDef="let app">{{ app.vendor }}</td>
          </ng-container>

          <!-- Table Rows -->
           <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns"
      (click)="showVulnerabilities(row)"
      class="cursor-pointer"
      [ngClass]="{
        'vulnerable-row': row.criticalVulnerabilityCount + row.highVulnerabilityCount +
                          row.mediumVulnerabilityCount + row.lowVulnerabilityCount > 0,
                          'unresolved-row': !row.resolved,
        'normal-row': row.criticalVulnerabilityCount + row.highVulnerabilityCount +
                      row.mediumVulnerabilityCount + row.lowVulnerabilityCount === 0 && row.resolved
      }"
    ></tr>
        </table>

        <!-- No Data -->
        <div *ngIf="!pagedAppData.length" class="text-center p-2">No data found</div>
      </div>

      <!-- Pagination -->
      <div *ngIf="pagedAppData.length > 0" class="d-flex justify-content-end mt-2">
        <div class="col-7 d-flex justify-content-evenly align-items-center  height-fit-content">
           <mat-select
          class="border rounded page-size-width p-2"
          [(ngModel)]="recordIndex"
          (ngModelChange)="getPage($event)"
        >
          <mat-option *ngFor="let record of totalRecords" [value]="record">
            {{ record }}
          </mat-option>
        </mat-select>
          <mat-select class="border rounded page-size-width p-2"
                      [(ngModel)]="pageSize"
                      (ngModelChange)="onPageSizeChange($event)">
            <mat-option *ngFor="let size of pageSizes" [value]="size">{{ size }}</mat-option>
          </mat-select>

          <button (click)="previousPage()"
                  [disabled]="pageIndex === 0"
                  class="page-custom-btn btn d-flex justify-content-center align-items-center outline-0 border-0 p-2">
            <mat-icon class="material-symbols-outlined fs-5">arrow_back_ios</mat-icon>
          </button>

          <button (click)="nextPage()"
                  [disabled]="pageIndex >= totalPages - 1"
                  class="page-custom-btn btn d-flex justify-content-center align-items-center outline-0 border-0 p-2">
            <mat-icon class="material-symbols-outlined fs-5">arrow_forward_ios</mat-icon>
          </button>
        </div>
      </div> <!-- pagination end-->
    </div> <!-- Application table date end-->

<!-- Application Dashboard section end -->